import{b as de,ax as ot,r as A,c as _,R as e,J as t,al as f,o as r,a as l,K as De,S as Fe,u as V,p as we,ay as nt,P as y,O as d,I as le,L as W,az as je,t as Je,X as it,E as ce,Q as ee,a5 as te,W as ut,aA as dt,aB as rt,aC as ct,au as pt}from"./vue-DsQqJGJA.js";import{h as ft,u as Ke,p as mt,a as $e,m as _t,d as We,f as vt,b as gt,l as yt,c as ht,e as bt,t as kt,E as m,g as Me,r as ye,i as wt,j as $t,k as qe,n as Ct,o as Vt,q as At,s as Tt}from"./elementPlus-BFSkUmg8.js";import{a as xt}from"./utils-B9ygI19o.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))x(g);new MutationObserver(g=>{for(const P of g)if(P.type==="childList")for(const w of P.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&x(w)}).observe(document,{childList:!0,subtree:!0});function h(g){const P={};return g.integrity&&(P.integrity=g.integrity),g.referrerPolicy&&(P.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?P.credentials="include":g.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function x(g){if(g.ep)return;g.ep=!0;const P=h(g);fetch(g.href,P)}})();const Mt="/vite.svg",Ce=(p,v)=>{const h=p.__vccOpts||p;for(const[x,g]of v)h[x]=g;return h},St={id:"app"},Ut={class:"sidebar"},Pt={class:"logo"},zt={src:Mt,alt:"Logo",class:"logo-img"},Lt={class:"header-content"},Et={class:"header-left"},Dt={__name:"App",setup(p){const v=ot(),h=de(()=>v.path),x=A(!1),g=()=>{x.value=!x.value};return(P,w)=>{const $=f("el-icon"),M=f("el-menu-item"),F=f("el-menu"),N=f("el-aside"),q=f("el-header"),B=f("router-view"),D=f("el-main"),c=f("el-container");return r(),_("div",St,[e(c,null,{default:t(()=>[e(N,{width:x.value?"64px":"200px"},{default:t(()=>[l("div",Ut,[l("div",Pt,[De(l("img",zt,null,512),[[Fe,x.value]]),De(l("h2",null,"自媒体自动化运营系统",512),[[Fe,!x.value]])]),e(F,{router:!0,"default-active":h.value,collapse:x.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(M,{index:"/"},{default:t(()=>[e($,null,{default:t(()=>[e(V(ft))]),_:1}),w[0]||(w[0]=l("span",null,"首页",-1))]),_:1}),e(M,{index:"/account-management"},{default:t(()=>[e($,null,{default:t(()=>[e(V(Ke))]),_:1}),w[1]||(w[1]=l("span",null,"账号管理",-1))]),_:1}),e(M,{index:"/material-management"},{default:t(()=>[e($,null,{default:t(()=>[e(V(mt))]),_:1}),w[2]||(w[2]=l("span",null,"素材管理",-1))]),_:1}),e(M,{index:"/publish-center"},{default:t(()=>[e($,null,{default:t(()=>[e(V($e))]),_:1}),w[3]||(w[3]=l("span",null,"发布中心",-1))]),_:1}),e(M,{index:"/website"},{default:t(()=>[e($,null,{default:t(()=>[e(V(_t))]),_:1}),w[4]||(w[4]=l("span",null,"网站",-1))]),_:1}),e(M,{index:"/data"},{default:t(()=>[e($,null,{default:t(()=>[e(V(We))]),_:1}),w[5]||(w[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(c,null,{default:t(()=>[e(q,null,{default:t(()=>[l("div",Lt,[l("div",Et,[e($,{class:"toggle-sidebar",onClick:g},{default:t(()=>[e(V(vt))]),_:1})]),w[6]||(w[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(D,null,{default:t(()=>[e(B)]),_:1})]),_:1})]),_:1})])}}},Ft=Ce(Dt,[["__scopeId","data-v-176fbaed"]]),It={class:"dashboard"},Rt={class:"dashboard-content"},Bt={class:"stat-card-content"},Ot={class:"stat-icon"},Nt={class:"stat-info"},qt={class:"stat-value"},jt={class:"stat-footer"},Jt={class:"stat-detail"},Kt={class:"stat-card-content"},Wt={class:"stat-icon platform-icon"},Ht={class:"stat-info"},Xt={class:"stat-value"},Qt={class:"stat-footer"},Gt={class:"stat-detail"},Yt={class:"stat-card-content"},Zt={class:"stat-icon task-icon"},el={class:"stat-info"},tl={class:"stat-value"},ll={class:"stat-footer"},sl={class:"stat-detail"},al={class:"stat-card-content"},ol={class:"stat-icon content-icon"},nl={class:"stat-info"},il={class:"stat-value"},ul={class:"stat-footer"},dl={class:"stat-detail"},rl={class:"quick-actions"},cl={class:"action-icon"},pl={class:"action-icon"},fl={class:"action-icon"},ml={class:"action-icon"},_l={class:"recent-tasks"},vl={class:"section-header"},gl={__name:"Dashboard",setup(p){const v=nt(),h=we({total:12,normal:10,abnormal:2}),x=we({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),g=we({total:24,completed:18,inProgress:5,failed:1}),P=we({total:36,published:30,draft:6}),w=A([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),$=D=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[D]||"info",M=D=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[D]||"info",F=D=>{v.push(D)},N=D=>{m.info(`查看任务: ${D.title}`)},q=D=>{Me.confirm(`确定要执行任务 ${D.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const c=w.value.findIndex(j=>j.id===D.id);c!==-1&&(w.value[c].status="进行中"),m({type:"success",message:"任务已开始执行"})}).catch(()=>{})},B=D=>{Me.confirm(`确定要取消任务 ${D.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const c=w.value.findIndex(j=>j.id===D.id);c!==-1&&(w.value[c].status="已取消"),m({type:"success",message:"任务已取消"})}).catch(()=>{})};return(D,c)=>{const j=f("el-icon"),T=f("el-card"),X=f("el-col"),R=f("el-tag"),L=f("el-tooltip"),Q=f("el-row"),G=f("el-button"),J=f("el-table-column"),b=f("el-table");return r(),_("div",It,[c[19]||(c[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",Rt,[e(Q,{gutter:20},{default:t(()=>[e(X,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Bt,[l("div",Ot,[e(j,null,{default:t(()=>[e(V(Ke))]),_:1})]),l("div",Nt,[l("div",qt,y(h.total),1),c[1]||(c[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",jt,[l("div",Jt,[l("span",null,"正常: "+y(h.normal),1),l("span",null,"异常: "+y(h.abnormal),1)])])]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Kt,[l("div",Wt,[e(j,null,{default:t(()=>[e(V(gt))]),_:1})]),l("div",Ht,[l("div",Xt,y(x.total),1),c[2]||(c[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",Qt,[l("div",Gt,[e(L,{content:"快手账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"success"},{default:t(()=>[d(y(x.kuaishou),1)]),_:1})]),_:1}),e(L,{content:"抖音账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"danger"},{default:t(()=>[d(y(x.douyin),1)]),_:1})]),_:1}),e(L,{content:"视频号账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"warning"},{default:t(()=>[d(y(x.channels),1)]),_:1})]),_:1}),e(L,{content:"小红书账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"info"},{default:t(()=>[d(y(x.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Yt,[l("div",Zt,[e(j,null,{default:t(()=>[e(V(yt))]),_:1})]),l("div",el,[l("div",tl,y(g.total),1),c[3]||(c[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",ll,[l("div",sl,[l("span",null,"完成: "+y(g.completed),1),l("span",null,"进行中: "+y(g.inProgress),1),l("span",null,"失败: "+y(g.failed),1)])])]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",al,[l("div",ol,[e(j,null,{default:t(()=>[e(V(ht))]),_:1})]),l("div",nl,[l("div",il,y(P.total),1),c[4]||(c[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",ul,[l("div",dl,[l("span",null,"已发布: "+y(P.published),1),l("span",null,"草稿: "+y(P.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",rl,[c[13]||(c[13]=l("h2",null,"快捷操作",-1)),e(Q,{gutter:20},{default:t(()=>[e(X,{span:6},{default:t(()=>[e(T,{class:"action-card",onClick:c[0]||(c[0]=u=>F("/account-management"))},{default:t(()=>[l("div",cl,[e(j,null,{default:t(()=>[e(V(bt))]),_:1})]),c[5]||(c[5]=l("div",{class:"action-title"},"账号管理",-1)),c[6]||(c[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",pl,[e(j,null,{default:t(()=>[e(V($e))]),_:1})]),c[7]||(c[7]=l("div",{class:"action-title"},"内容上传",-1)),c[8]||(c[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",fl,[e(j,null,{default:t(()=>[e(V(kt))]),_:1})]),c[9]||(c[9]=l("div",{class:"action-title"},"定时发布",-1)),c[10]||(c[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(X,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",ml,[e(j,null,{default:t(()=>[e(V(We))]),_:1})]),c[11]||(c[11]=l("div",{class:"action-title"},"数据分析",-1)),c[12]||(c[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",_l,[l("div",vl,[c[15]||(c[15]=l("h2",null,"最近任务",-1)),e(G,{text:""},{default:t(()=>[...c[14]||(c[14]=[d("查看全部",-1)])]),_:1})]),e(b,{data:w.value,style:{width:"100%"}},{default:t(()=>[e(J,{prop:"title",label:"任务名称",width:"250"}),e(J,{prop:"platform",label:"平台",width:"120"},{default:t(u=>[e(R,{type:$(u.row.platform),effect:"plain"},{default:t(()=>[d(y(u.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(J,{prop:"account",label:"账号",width:"150"}),e(J,{prop:"createTime",label:"创建时间",width:"180"}),e(J,{prop:"status",label:"状态",width:"120"},{default:t(u=>[e(R,{type:M(u.row.status),effect:"plain"},{default:t(()=>[d(y(u.row.status),1)]),_:2},1032,["type"])]),_:1}),e(J,{label:"操作"},{default:t(u=>[e(G,{size:"small",onClick:K=>N(u.row)},{default:t(()=>[...c[16]||(c[16]=[d("查看",-1)])]),_:1},8,["onClick"]),u.row.status==="待执行"?(r(),le(G,{key:0,size:"small",type:"primary",onClick:K=>q(u.row)},{default:t(()=>[...c[17]||(c[17]=[d(" 执行 ",-1)])]),_:1},8,["onClick"])):W("",!0),u.row.status!=="已完成"&&u.row.status!=="已失败"?(r(),le(G,{key:1,size:"small",type:"danger",onClick:K=>B(u.row)},{default:t(()=>[...c[18]||(c[18]=[d(" 取消 ",-1)])]),_:1},8,["onClick"])):W("",!0)]),_:1})]),_:1},8,["data"])])])])}}},yl=Ce(gl,[["__scopeId","data-v-db5c2d61"]]),he=xt.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});he.interceptors.request.use(p=>{const v=localStorage.getItem("token");return v&&(p.headers.Authorization=`Bearer ${v}`),p},p=>(console.error("请求错误:",p),Promise.reject(p)));he.interceptors.response.use(p=>{const{data:v}=p;return v.code===200||v.success?v:(m.error(v.message||"请求失败"),Promise.reject(new Error(v.message||"请求失败")))},p=>{if(console.error("响应错误:",p),p.response){const{status:v}=p.response;switch(v){case 401:m.error("未授权，请重新登录");break;case 403:m.error("拒绝访问");break;case 404:m.error("请求地址不存在");break;case 500:m.error("服务器内部错误");break;default:m.error("网络错误")}}else m.error("网络连接失败");return Promise.reject(p)});const be={get(p,v){return he.get(p,{params:v})},post(p,v,h={}){return he.post(p,v,h)},put(p,v,h={}){return he.put(p,v,h)},delete(p,v){return he.delete(p,{params:v})},upload(p,v){return he.post(p,v,{headers:{"Content-Type":"multipart/form-data"}})}},Ee={getValidAccounts(){return be.get("/getValidAccounts")},addAccount(p){return be.post("/account",p)},updateAccount(p){return be.post("/updateUserinfo",p)},deleteAccount(p){return be.get(`/deleteAccount?id=${p}`)}},He=je("account",()=>{const p=A([]),v={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:p,setAccounts:$=>{p.value=$.map(M=>({id:M[0],type:M[1],filePath:M[2],name:M[3],status:M[4]===1?"正常":"异常",platform:v[M[1]]||"未知",avatar:"/vite.svg"}))},addAccount:$=>{p.value.push($)},updateAccount:($,M)=>{const F=p.value.findIndex(N=>N.id===$);F!==-1&&(p.value[F]={...p.value[F],...M})},deleteAccount:$=>{p.value=p.value.filter(M=>M.id!==$)},getAccountsByPlatform:$=>p.value.filter(M=>M.platform===$)}}),Ie=je("app",()=>{const p=A(!0),v=A(!0),h=A(!1),x=A([]);return{isFirstTimeAccountManagement:p,isFirstTimeMaterialManagement:v,isAccountRefreshing:h,materials:x,setAccountManagementVisited:()=>{p.value=!1},setMaterialManagementVisited:()=>{v.value=!1},resetVisitStatus:()=>{p.value=!0,v.value=!0},setMaterials:q=>{x.value=q},addMaterial:q=>{x.value.push(q)},removeMaterial:q=>{const B=x.value.findIndex(D=>D.id===q);B>-1&&x.value.splice(B,1)},setAccountRefreshing:q=>{h.value=q}}}),hl={class:"account-management"},bl={class:"account-tabs"},kl={class:"account-list-container"},wl={class:"account-search"},$l={class:"action-buttons"},Cl={key:0},Vl={key:0,class:"account-list"},Al={key:1,class:"empty-data"},Tl={class:"account-list-container"},xl={class:"account-search"},Ml={class:"action-buttons"},Sl={key:0},Ul={key:0,class:"account-list"},Pl={key:1,class:"empty-data"},zl={class:"account-list-container"},Ll={class:"account-search"},El={class:"action-buttons"},Dl={key:0},Fl={key:0,class:"account-list"},Il={key:1,class:"empty-data"},Rl={class:"account-list-container"},Bl={class:"account-search"},Ol={class:"action-buttons"},Nl={key:0},ql={key:0,class:"account-list"},jl={key:1,class:"empty-data"},Jl={class:"account-list-container"},Kl={class:"account-search"},Wl={class:"action-buttons"},Hl={key:0},Xl={key:0,class:"account-list"},Ql={key:1,class:"empty-data"},Gl={key:0,class:"qrcode-container"},Yl={key:0,class:"qrcode-wrapper"},Zl=["src"],es={key:1,class:"loading-wrapper"},ts={key:2,class:"success-wrapper"},ls={key:3,class:"error-wrapper"},ss={class:"dialog-footer"},as={__name:"AccountManagement",setup(p){const v=He(),h=Ie(),x=A("all"),g=A(""),P=async()=>{if(!h.isAccountRefreshing){h.setAccountRefreshing(!0);try{const z=await Ee.getValidAccounts();z.code===200&&z.data?(v.setAccounts(z.data),m.success("账号数据获取成功"),h.isFirstTimeAccountManagement&&h.setAccountManagementVisited()):m.error("获取账号数据失败")}catch(z){console.error("获取账号数据失败:",z),m.error("获取账号数据失败")}finally{h.setAccountRefreshing(!1)}}};Je(()=>{h.isFirstTimeAccountManagement&&P()});const w=z=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[z]||"info",$=de(()=>g.value?v.accounts.filter(z=>z.name.includes(g.value)):v.accounts),M=de(()=>$.value.filter(z=>z.platform==="快手")),F=de(()=>$.value.filter(z=>z.platform==="抖音")),N=de(()=>$.value.filter(z=>z.platform==="视频号")),q=de(()=>$.value.filter(z=>z.platform==="小红书")),B=()=>{},D=A(!1),c=A("add"),j=A(null),T=we({id:null,name:"",platform:"",status:"正常"}),X={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},R=A(!1),L=A(""),Q=A(""),G=()=>{c.value="add",Object.assign(T,{id:null,name:"",platform:"",status:"正常"}),R.value=!1,L.value="",Q.value="",D.value=!0},J=z=>{c.value="edit",Object.assign(T,{...z}),D.value=!0},b=z=>{Me.confirm(`确定要删除账号 ${z.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const n=await Ee.deleteAccount(z.id);n.code===200?(v.deleteAccount(z.id),m({type:"success",message:"删除成功"})):m.error(n.msg||"删除失败")}catch(n){console.error("删除账号失败:",n),m.error("删除账号失败")}}).catch(()=>{})};let u=null;const K=()=>{u&&(u.close(),u=null)},se=(z,n)=>{K(),R.value=!0,L.value="",Q.value="";const oe=`http://localhost:5409/login?type=${{小红书:"1",视频号:"2",抖音:"3",快手:"4"}[z]||"1"}&id=${encodeURIComponent(n)}`;u=new EventSource(oe),u.onmessage=E=>{const S=E.data;if(console.log("SSE消息:",S),!L.value&&S.length>100)try{S.startsWith("data:image")?L.value=S:L.value=`data:image/png;base64,${S}`,console.log("设置二维码数据，长度:",S.length)}catch(ne){console.error("处理二维码数据出错:",ne)}else(S==="200"||S==="500")&&(Q.value=S,S==="200"?setTimeout(()=>{K(),setTimeout(()=>{D.value=!1,R.value=!1,m.success("账号添加成功"),m({type:"info",message:"正在同步账号信息...",duration:0}),P().then(()=>{m.closeAll(),m.success("账号信息已更新")})},1e3)},1e3):(K(),setTimeout(()=>{R.value=!1,L.value="",Q.value=""},2e3)))},u.onerror=E=>{console.error("SSE连接错误:",E),m.error("连接服务器失败，请稍后再试"),K(),R.value=!1}},ke=()=>{j.value.validate(async z=>{if(z)if(c.value==="add")se(T.platform,T.name);else try{const n=await Ee.updateAccount({id:T.id,type:T.platform==="快手"?1:T.platform==="抖音"?2:T.platform==="视频号"?3:4,userName:T.name});n.code===200?(v.updateAccount(T.id,T),m.success("更新成功"),D.value=!1,P()):m.error(n.msg||"更新账号失败")}catch(n){console.error("更新账号失败:",n),m.error("更新账号失败")}else return!1})};return it(()=>{K()}),(z,n)=>{const ae=f("el-input"),I=f("el-button"),Z=f("el-icon"),oe=f("el-avatar"),E=f("el-table-column"),S=f("el-tag"),ne=f("el-table"),fe=f("el-empty"),me=f("el-tab-pane"),Se=f("el-tabs"),_e=f("el-option"),Ue=f("el-select"),Te=f("el-form-item"),Pe=f("el-form"),ze=f("el-dialog");return r(),_("div",hl,[n[30]||(n[30]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",bl,[e(Se,{modelValue:x.value,"onUpdate:modelValue":n[5]||(n[5]=i=>x.value=i),class:"account-tabs-nav"},{default:t(()=>[e(me,{label:"全部",name:"all"},{default:t(()=>[l("div",kl,[l("div",wl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=i=>g.value=i),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",$l,[e(I,{type:"primary",onClick:G},{default:t(()=>[...n[10]||(n[10]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:P,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":V(h).isAccountRefreshing})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),V(h).isAccountRefreshing?(r(),_("span",Cl,"刷新中")):W("",!0)]),_:1})])]),$.value.length>0?(r(),_("div",Vl,[e(ne,{data:$.value,style:{width:"100%"}},{default:t(()=>[e(E,{label:"头像",width:"80"},{default:t(i=>[e(oe,{src:i.row.avatar,size:40},null,8,["src"])]),_:1}),e(E,{prop:"name",label:"名称",width:"180"}),e(E,{prop:"platform",label:"平台"},{default:t(i=>[e(S,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(E,{prop:"status",label:"状态"},{default:t(i=>[e(S,{type:i.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作"},{default:t(i=>[e(I,{size:"small",onClick:Y=>J(i.row)},{default:t(()=>[...n[11]||(n[11]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:Y=>b(i.row)},{default:t(()=>[...n[12]||(n[12]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",Al,[e(fe,{description:"暂无账号数据"})]))])]),_:1}),e(me,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",Tl,[l("div",xl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":n[1]||(n[1]=i=>g.value=i),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Ml,[e(I,{type:"primary",onClick:G},{default:t(()=>[...n[13]||(n[13]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:P,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":V(h).isAccountRefreshing})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),V(h).isAccountRefreshing?(r(),_("span",Sl,"刷新中")):W("",!0)]),_:1})])]),M.value.length>0?(r(),_("div",Ul,[e(ne,{data:M.value,style:{width:"100%"}},{default:t(()=>[e(E,{label:"头像",width:"80"},{default:t(i=>[e(oe,{src:i.row.avatar,size:40},null,8,["src"])]),_:1}),e(E,{prop:"name",label:"名称",width:"180"}),e(E,{prop:"platform",label:"平台"},{default:t(i=>[e(S,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(E,{prop:"status",label:"状态"},{default:t(i=>[e(S,{type:i.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作"},{default:t(i=>[e(I,{size:"small",onClick:Y=>J(i.row)},{default:t(()=>[...n[14]||(n[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:Y=>b(i.row)},{default:t(()=>[...n[15]||(n[15]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",Pl,[e(fe,{description:"暂无快手账号数据"})]))])]),_:1}),e(me,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",zl,[l("div",Ll,[e(ae,{modelValue:g.value,"onUpdate:modelValue":n[2]||(n[2]=i=>g.value=i),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",El,[e(I,{type:"primary",onClick:G},{default:t(()=>[...n[16]||(n[16]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:P,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":V(h).isAccountRefreshing})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),V(h).isAccountRefreshing?(r(),_("span",Dl,"刷新中")):W("",!0)]),_:1})])]),F.value.length>0?(r(),_("div",Fl,[e(ne,{data:F.value,style:{width:"100%"}},{default:t(()=>[e(E,{label:"头像",width:"80"},{default:t(i=>[e(oe,{src:i.row.avatar,size:40},null,8,["src"])]),_:1}),e(E,{prop:"name",label:"名称",width:"180"}),e(E,{prop:"platform",label:"平台"},{default:t(i=>[e(S,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(E,{prop:"status",label:"状态"},{default:t(i=>[e(S,{type:i.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作"},{default:t(i=>[e(I,{size:"small",onClick:Y=>J(i.row)},{default:t(()=>[...n[17]||(n[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:Y=>b(i.row)},{default:t(()=>[...n[18]||(n[18]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",Il,[e(fe,{description:"暂无抖音账号数据"})]))])]),_:1}),e(me,{label:"视频号",name:"channels"},{default:t(()=>[l("div",Rl,[l("div",Bl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":n[3]||(n[3]=i=>g.value=i),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Ol,[e(I,{type:"primary",onClick:G},{default:t(()=>[...n[19]||(n[19]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:P,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":V(h).isAccountRefreshing})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),V(h).isAccountRefreshing?(r(),_("span",Nl,"刷新中")):W("",!0)]),_:1})])]),N.value.length>0?(r(),_("div",ql,[e(ne,{data:N.value,style:{width:"100%"}},{default:t(()=>[e(E,{label:"头像",width:"80"},{default:t(i=>[e(oe,{src:i.row.avatar,size:40},null,8,["src"])]),_:1}),e(E,{prop:"name",label:"名称",width:"180"}),e(E,{prop:"platform",label:"平台"},{default:t(i=>[e(S,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(E,{prop:"status",label:"状态"},{default:t(i=>[e(S,{type:i.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作"},{default:t(i=>[e(I,{size:"small",onClick:Y=>J(i.row)},{default:t(()=>[...n[20]||(n[20]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:Y=>b(i.row)},{default:t(()=>[...n[21]||(n[21]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",jl,[e(fe,{description:"暂无视频号账号数据"})]))])]),_:1}),e(me,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Jl,[l("div",Kl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=i=>g.value=i),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Wl,[e(I,{type:"primary",onClick:G},{default:t(()=>[...n[22]||(n[22]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:P,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":V(h).isAccountRefreshing})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),V(h).isAccountRefreshing?(r(),_("span",Hl,"刷新中")):W("",!0)]),_:1})])]),q.value.length>0?(r(),_("div",Xl,[e(ne,{data:q.value,style:{width:"100%"}},{default:t(()=>[e(E,{label:"头像",width:"80"},{default:t(i=>[e(oe,{src:i.row.avatar,size:40},null,8,["src"])]),_:1}),e(E,{prop:"name",label:"名称",width:"180"}),e(E,{prop:"platform",label:"平台"},{default:t(i=>[e(S,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(E,{prop:"status",label:"状态"},{default:t(i=>[e(S,{type:i.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作"},{default:t(i=>[e(I,{size:"small",onClick:Y=>J(i.row)},{default:t(()=>[...n[23]||(n[23]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:Y=>b(i.row)},{default:t(()=>[...n[24]||(n[24]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",Ql,[e(fe,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(ze,{modelValue:D.value,"onUpdate:modelValue":n[9]||(n[9]=i=>D.value=i),title:c.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!R.value,"show-close":!R.value},{footer:t(()=>[l("span",ss,[e(I,{onClick:n[8]||(n[8]=i=>D.value=!1)},{default:t(()=>[...n[29]||(n[29]=[d("取消",-1)])]),_:1}),e(I,{type:"primary",onClick:ke,loading:R.value,disabled:R.value},{default:t(()=>[d(y(R.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Pe,{model:T,"label-width":"80px",rules:X,ref_key:"accountFormRef",ref:j},{default:t(()=>[e(Te,{label:"平台",prop:"platform"},{default:t(()=>[e(Ue,{modelValue:T.platform,"onUpdate:modelValue":n[6]||(n[6]=i=>T.platform=i),placeholder:"请选择平台",style:{width:"100%"},disabled:c.value==="edit"||R.value},{default:t(()=>[e(_e,{label:"快手",value:"快手"}),e(_e,{label:"抖音",value:"抖音"}),e(_e,{label:"视频号",value:"视频号"}),e(_e,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Te,{label:"名称",prop:"name"},{default:t(()=>[e(ae,{modelValue:T.name,"onUpdate:modelValue":n[7]||(n[7]=i=>T.name=i),placeholder:"请输入账号名称",disabled:R.value},null,8,["modelValue","disabled"])]),_:1}),R.value?(r(),_("div",Gl,[L.value&&!Q.value?(r(),_("div",Yl,[n[25]||(n[25]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:L.value,alt:"登录二维码",class:"qrcode-image"},null,8,Zl)])):!L.value&&!Q.value?(r(),_("div",es,[e(Z,{class:"is-loading"},{default:t(()=>[e(V(ye))]),_:1}),n[26]||(n[26]=l("span",null,"请求中...",-1))])):Q.value==="200"?(r(),_("div",ts,[e(Z,null,{default:t(()=>[e(V(wt))]),_:1}),n[27]||(n[27]=l("span",null,"添加成功",-1))])):Q.value==="500"?(r(),_("div",ls,[e(Z,null,{default:t(()=>[e(V($t))]),_:1}),n[28]||(n[28]=l("span",null,"添加失败，请稍后再试",-1))])):W("",!0)])):W("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])}}},os=Ce(as,[["__scopeId","data-v-23e28d1f"]]),pe={getAllMaterials:()=>be.get("/getFiles"),uploadMaterial:p=>be.upload("/uploadSave",p),deleteMaterial:p=>be.get(`/deleteFile?id=${p}`),downloadMaterial:p=>`http://localhost:5409/download/${p}`,getMaterialPreviewUrl:p=>`http://localhost:5409/getFile?filename=${p}`},ns={class:"material-management"},is={class:"material-list-container"},us={class:"material-search"},ds={class:"action-buttons"},rs={key:0},cs={key:0,class:"material-list"},ps={key:1,class:"empty-data"},fs={class:"upload-form"},ms={class:"dialog-footer"},_s={key:0,class:"preview-container"},vs={key:0,class:"video-preview"},gs={controls:"",style:{"max-width":"100%","max-height":"60vh"}},ys=["src"],hs={key:1,class:"image-preview"},bs=["src"],ks={key:2,class:"file-info"},ws={__name:"MaterialManagement",setup(p){const v=Ie(),h=A(""),x=A(!1),g=A(!1),P=A(!1),w=A(!1),$=A(null),M=A([]),F=A(""),N=async()=>{x.value=!0;try{const b=await pe.getAllMaterials();b.code===200?(v.setMaterials(b.data),m.success("刷新成功")):m.error("获取素材列表失败")}catch(b){console.error("获取素材列表出错:",b),m.error("获取素材列表失败")}finally{x.value=!1}},q=de(()=>{if(!h.value)return v.materials;const b=h.value.toLowerCase();return v.materials.filter(u=>u.filename.toLowerCase().includes(b))}),B=()=>{},D=()=>{M.value=[],F.value="",P.value=!0},c=()=>{M.value=[],F.value=""},j=(b,u)=>{console.log("选择的文件:",b),b.raw&&(M.value=[b])},T=async()=>{if(M.value.length===0){m.warning("请选择要上传的文件");return}const b=M.value[0];if(!b||!b.raw){m.warning("文件对象无效，请重新选择文件");return}g.value=!0;try{const u=new FormData;console.log("上传文件对象:",b.raw),u.append("file",b.raw),F.value.trim()&&(u.append("filename",F.value.trim()),console.log("自定义文件名:",F.value.trim()));const K=await pe.uploadMaterial(u);K.code===200?(m.success("上传成功"),P.value=!1,await N()):m.error(K.msg||"上传失败")}catch(u){console.error("上传素材出错:",u),m.error("上传失败: "+(u.message||"未知错误"))}finally{g.value=!1}},X=async b=>{$.value=null,w.value=!0,m.info("加载中...");try{await new Promise(u=>setTimeout(u,100)),$.value=b}catch(u){console.error("预览素材出错:",u),m.error("预览加载失败"),w.value=!1}},R=b=>{Me.confirm(`确定要删除素材 ${b.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const u=await pe.deleteMaterial(b.id);u.code===200?(v.removeMaterial(b.id),m.success("删除成功")):m.error(u.msg||"删除失败")}catch(u){console.error("删除素材出错:",u),m.error("删除失败")}}).catch(()=>{})},L=b=>{const u=b.split("/").pop();return pe.getMaterialPreviewUrl(u)},Q=b=>{const u=pe.downloadMaterial(b.file_path);window.open(u,"_blank")},G=b=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(K=>b.toLowerCase().endsWith(K)),J=b=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(K=>b.toLowerCase().endsWith(K));return Je(()=>{v.materials.length===0&&N()}),(b,u)=>{const K=f("el-input"),se=f("el-button"),ke=f("el-icon"),z=f("el-table-column"),n=f("el-table"),ae=f("el-empty"),I=f("el-form-item"),Z=f("el-upload"),oe=f("el-form"),E=f("el-dialog");return r(),_("div",ns,[u[14]||(u[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",is,[l("div",us,[e(K,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=S=>h.value=S),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",ds,[e(se,{type:"primary",onClick:D},{default:t(()=>[...u[6]||(u[6]=[d("上传素材",-1)])]),_:1}),e(se,{type:"info",onClick:N,loading:!1},{default:t(()=>[e(ke,{class:ce({"is-loading":x.value})},{default:t(()=>[e(V(ye))]),_:1},8,["class"]),x.value?(r(),_("span",rs,"刷新中")):W("",!0)]),_:1})])]),q.value.length>0?(r(),_("div",cs,[e(n,{data:q.value,style:{width:"100%"}},{default:t(()=>[e(z,{prop:"filename",label:"文件名",width:"300"}),e(z,{prop:"filesize",label:"文件大小",width:"120"},{default:t(S=>[d(y(S.row.filesize)+" MB ",1)]),_:1}),e(z,{prop:"upload_time",label:"上传时间",width:"180"}),e(z,{label:"操作"},{default:t(S=>[e(se,{size:"small",onClick:ne=>X(S.row)},{default:t(()=>[...u[7]||(u[7]=[d("预览",-1)])]),_:1},8,["onClick"]),e(se,{size:"small",type:"danger",onClick:ne=>R(S.row)},{default:t(()=>[...u[8]||(u[8]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),_("div",ps,[e(ae,{description:"暂无素材数据"})]))]),e(E,{modelValue:P.value,"onUpdate:modelValue":u[3]||(u[3]=S=>P.value=S),title:"上传素材",width:"40%",onClose:c},{footer:t(()=>[l("div",ms,[e(se,{onClick:u[2]||(u[2]=S=>P.value=!1)},{default:t(()=>[...u[11]||(u[11]=[d("取消",-1)])]),_:1}),e(se,{type:"primary",onClick:T,loading:g.value},{default:t(()=>[d(y(g.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",fs,[e(oe,{"label-width":"80px"},{default:t(()=>[e(I,{label:"文件名称:"},{default:t(()=>[e(K,{modelValue:F.value,"onUpdate:modelValue":u[1]||(u[1]=S=>F.value=S),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{label:"选择文件"},{default:t(()=>[e(Z,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":j,"file-list":M.value,limit:1},{tip:t(()=>[...u[9]||(u[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(ke,{class:"el-icon--upload"},{default:t(()=>[e(V($e))]),_:1}),u[10]||(u[10]=l("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e(E,{modelValue:w.value,"onUpdate:modelValue":u[5]||(u[5]=S=>w.value=S),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[$.value?(r(),_("div",_s,[G($.value.filename)?(r(),_("div",vs,[l("video",gs,[l("source",{src:L($.value.file_path),type:"video/mp4"},null,8,ys),u[12]||(u[12]=d(" 您的浏览器不支持视频播放 ",-1))])])):J($.value.filename)?(r(),_("div",hs,[l("img",{src:L($.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,bs)])):(r(),_("div",ks,[l("p",null,"文件名: "+y($.value.filename),1),l("p",null,"文件大小: "+y($.value.filesize)+" MB",1),l("p",null,"上传时间: "+y($.value.upload_time),1),e(se,{type:"primary",onClick:u[4]||(u[4]=S=>Q($.value))},{default:t(()=>[...u[13]||(u[13]=[d("下载文件",-1)])]),_:1})]))])):W("",!0)]),_:1},8,["modelValue"])])}}},$s=Ce(ws,[["__scopeId","data-v-3d75da5e"]]),Cs={class:"publish-center"},Vs={class:"tab-management"},As={class:"tab-header"},Ts={class:"tab-list"},xs=["onClick"],Ms={class:"tab-actions"},Ss={class:"publish-content"},Us={class:"tab-content-wrapper"},Ps={key:0,class:"publish-status"},zs={class:"upload-section"},Ls={class:"upload-options"},Es={key:0,class:"uploaded-files"},Ds={class:"file-list"},Fs={class:"file-size"},Is={class:"upload-options-content"},Rs={class:"publish-progress"},Bs={key:0,class:"current-publishing"},Os={key:1,class:"publish-results"},Ns={class:"label"},qs={class:"message"},js={class:"dialog-footer"},Js={class:"material-library-content"},Ks={class:"material-list"},Ws={class:"material-info"},Hs={class:"material-name"},Xs={class:"material-details"},Qs={class:"file-size"},Gs={class:"upload-time"},Ys={class:"dialog-footer"},Zs={class:"account-section"},ea={class:"account-display"},ta={class:"selected-accounts"},la={class:"account-dialog-content"},sa={class:"account-list"},aa={class:"account-info"},oa={class:"account-name"},na={class:"dialog-footer"},ia={class:"platform-section"},ua={class:"title-section"},da={class:"topic-section"},ra={class:"topic-display"},ca={class:"selected-topics"},pa={class:"topic-dialog-content"},fa={class:"custom-topic-input"},ma={class:"recommended-topics"},_a={class:"topic-grid"},va={class:"dialog-footer"},ga={key:1,class:"product-section"},ya={class:"schedule-section"},ha={class:"schedule-controls"},ba={key:0,class:"schedule-settings"},ka={class:"schedule-item"},wa={class:"schedule-item"},$a={class:"schedule-item"},Ca={class:"action-buttons"},Va={__name:"PublishCenter",setup(p){const v="http://localhost:5409",h=de(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),x=A("tab1");let g=1;const P=Ie(),w=A(!1),$=A(!1),M=A(!1),F=A(null),N=A([]),q=de(()=>P.materials),B=A(!1);A(""),A("info");const D=[{key:3,name:"抖音"},{key:4,name:"快手"},{key:2,name:"视频号"},{key:1,name:"小红书"}],c={name:"tab1",label:"发布1",fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",productLink:"",productTitle:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null},j=()=>{try{return typeof structuredClone=="function"?structuredClone(c):JSON.parse(JSON.stringify(c))}catch{return JSON.parse(JSON.stringify(c))}},T=we([j()]),X=A(!1),R=A([]),L=A(null),Q=He(),G=de(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"},s=L.value?o[L.value.selectedPlatform]:null;return s?Q.accounts.filter(U=>U.platform===s):[]}),J=A(!1),b=A(""),u=["游戏","电影","音乐","美食","旅行","文化","科技","生活","娱乐","体育","教育","艺术","健康","时尚","美妆","摄影","宠物","汽车"],K=()=>{g++;const o=j();o.name=`tab${g}`,o.label=`发布${g}`,T.push(o),x.value=o.name},se=o=>{const s=T.findIndex(U=>U.name===o);s>-1&&(T.splice(s,1),x.value===o&&T.length>0&&(x.value=T[0].name))},ke=(o,s,U)=>{if(o.code===200){const C=o.data.path||o.data,O=C.split("/").pop(),ie={name:s.name,url:pe.getMaterialPreviewUrl(O),path:C,size:s.size,type:s.type};U.fileList.push(ie),U.displayFileList=[...U.fileList.map(ue=>({name:ue.name,url:ue.url}))],m.success("文件上传成功"),console.log("上传成功:",ie)}else m.error(o.msg||"上传失败")},z=o=>{m.error("文件上传失败"),console.error("上传错误:",o)},n=(o,s)=>{o.fileList.splice(s,1),o.displayFileList=[...o.fileList.map(U=>({name:U.name,url:U.url}))],m.success("文件删除成功")},ae=o=>{L.value=o,J.value=!0},I=()=>{if(!b.value.trim()){m.warning("请输入话题内容");return}L.value&&!L.value.selectedTopics.includes(b.value.trim())?(L.value.selectedTopics.push(b.value.trim()),b.value="",m.success("话题添加成功")):m.warning("话题已存在")},Z=o=>{if(!L.value)return;const s=L.value.selectedTopics.indexOf(o);s>-1?L.value.selectedTopics.splice(s,1):L.value.selectedTopics.push(o)},oe=(o,s)=>{o.selectedTopics.splice(s,1)},E=()=>{J.value=!1,b.value="",L.value=null,m.success("添加话题完成")},S=o=>{L.value=o,R.value=[...o.selectedAccounts],X.value=!0},ne=()=>{L.value&&(L.value.selectedAccounts=[...R.value]),X.value=!1,L.value=null,m.success("账号选择完成")},fe=(o,s)=>{o.selectedAccounts.splice(s,1)},me=o=>{const s=Q.accounts.find(U=>U.id===o);return s?s.name:o},Se=o=>{m.info("已取消发布")},_e=async o=>new Promise((s,U)=>{if(o.fileList.length===0){m.error("请先上传视频文件"),U(new Error("请先上传视频文件"));return}if(!o.title.trim()){m.error("请输入标题"),U(new Error("请输入标题"));return}if(!o.selectedPlatform){m.error("请选择发布平台"),U(new Error("请选择发布平台"));return}if(o.selectedAccounts.length===0){m.error("请选择发布账号"),U(new Error("请选择发布账号"));return}const C={type:o.selectedPlatform,title:o.title,tags:o.selectedTopics,fileList:o.fileList.map(O=>O.path),accountList:o.selectedAccounts.map(O=>{const ie=Q.accounts.find(ue=>ue.id===O);return ie?ie.filePath:O}),enableTimer:o.scheduleEnabled?1:0,videosPerDay:o.scheduleEnabled&&o.videosPerDay||1,dailyTimes:o.scheduleEnabled?o.dailyTimes||["10:00"]:["10:00"],startDays:o.scheduleEnabled&&o.startDays||0,category:0,productLink:o.productLink.trim()||"",productTitle:o.productTitle.trim()||""};fetch(`${v}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...h.value},body:JSON.stringify(C)}).then(O=>O.json()).then(O=>{O.code===200?(o.publishStatus={message:"发布成功",type:"success"},o.fileList=[],o.displayFileList=[],o.title="",o.selectedTopics=[],o.selectedAccounts=[],o.scheduleEnabled=!1,s()):(o.publishStatus={message:`发布失败：${O.msg||"发布失败"}`,type:"error"},U(new Error(O.msg||"发布失败")))}).catch(O=>{console.error("发布错误:",O),o.publishStatus={message:"发布失败，请检查网络连接",type:"error"},U(O)})}),Ue=o=>{F.value=o,w.value=!0},Te=()=>{w.value=!1,$.value=!0},Pe=async()=>{if(w.value=!1,q.value.length===0)try{const o=await pe.getAllMaterials();if(o.code===200)P.setMaterials(o.data);else{m.error("获取素材列表失败");return}}catch(o){console.error("获取素材列表出错:",o),m.error("获取素材列表失败");return}N.value=[],M.value=!0},ze=()=>{if(N.value.length===0){m.warning("请选择至少一个素材");return}F.value&&(N.value.forEach(s=>{const U=q.value.find(C=>C.id===s);if(U){const C={name:U.filename,url:pe.getMaterialPreviewUrl(U.file_path.split("/").pop()),path:U.file_path,size:U.filesize*1024*1024,type:"video/mp4"};F.value.fileList.some(ie=>ie.path===C.path)||F.value.fileList.push(C)}}),F.value.displayFileList=[...F.value.fileList.map(s=>({name:s.name,url:s.url}))]);const o=N.value.length;M.value=!1,N.value=[],F.value=null,m.success(`已添加 ${o} 个素材`)},i=A(!1),Y=A(null),ve=A(0),re=A([]),Ve=A(!1),Xe=()=>{Ve.value=!0,m.info("正在取消发布...")},Qe=async()=>{if(!B.value){B.value=!0,Y.value=null,ve.value=0,re.value=[],Ve.value=!1,i.value=!0;try{for(let C=0;C<T.length;C++){if(Ve.value){re.value.push({label:T[C].label,status:"cancelled",message:"已取消"});continue}const O=T[C];Y.value=O,ve.value=Math.floor(C/T.length*100);try{await _e(O),re.value.push({label:O.label,status:"success",message:"发布成功"})}catch(ie){re.value.push({label:O.label,status:"error",message:ie.message})}}ve.value=100;const o=re.value.filter(C=>C.status==="success").length,s=re.value.filter(C=>C.status==="error").length,U=re.value.filter(C=>C.status==="cancelled").length;Ve.value?m.warning(`发布已取消：${o}个成功，${s}个失败，${U}个未执行`):s>0?m.error(`发布完成：${o}个成功，${s}个失败`):(m.success("所有Tab发布成功"),setTimeout(()=>{i.value=!1},1e3))}catch(o){console.error("批量发布出错:",o),m.error("批量发布出错，请重试")}finally{B.value=!1,Ve.value=!1}}};return(o,s)=>{const U=f("el-icon"),C=f("el-button"),O=f("el-alert"),ie=f("el-link"),ue=f("el-dialog"),Ge=f("el-upload"),Ye=f("el-progress"),Ze=f("Check"),et=f("InfoFilled"),Re=f("el-checkbox"),Be=f("el-checkbox-group"),Oe=f("el-tag"),tt=f("el-radio"),lt=f("el-radio-group"),xe=f("el-input"),st=f("el-switch"),Le=f("el-option"),Ne=f("el-select"),at=f("el-time-select");return r(),_("div",Cs,[l("div",Vs,[l("div",As,[l("div",Ts,[(r(!0),_(ee,null,te(T,k=>(r(),_("div",{key:k.name,class:ce(["tab-item",{active:x.value===k.name}]),onClick:a=>x.value=k.name},[l("span",null,y(k.label),1),T.length>1?(r(),le(U,{key:0,class:"close-icon",onClick:ut(a=>se(k.name),["stop"])},{default:t(()=>[e(V(qe))]),_:1},8,["onClick"])):W("",!0)],10,xs))),128))]),l("div",Ms,[e(C,{type:"primary",size:"small",onClick:K,class:"add-tab-btn"},{default:t(()=>[e(U,null,{default:t(()=>[e(V(Ct))]),_:1}),s[13]||(s[13]=d(" 添加Tab ",-1))]),_:1}),e(C,{type:"success",size:"small",onClick:Qe,loading:B.value,class:"batch-publish-btn"},{default:t(()=>[...s[14]||(s[14]=[d(" 批量发布 ",-1)])]),_:1},8,["loading"])])])]),l("div",Ss,[l("div",Us,[(r(!0),_(ee,null,te(T,k=>De((r(),_("div",{key:k.name,class:"tab-content"},[k.publishStatus?(r(),_("div",Ps,[e(O,{title:k.publishStatus.message,type:k.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):W("",!0),l("div",zs,[s[18]||(s[18]=l("h3",null,"视频",-1)),l("div",Ls,[e(C,{type:"primary",onClick:a=>Ue(k),class:"upload-btn"},{default:t(()=>[e(U,null,{default:t(()=>[e(V($e))]),_:1}),s[15]||(s[15]=d(" 上传视频 ",-1))]),_:1},8,["onClick"])]),k.fileList.length>0?(r(),_("div",Es,[s[17]||(s[17]=l("h4",null,"已上传文件：",-1)),l("div",Ds,[(r(!0),_(ee,null,te(k.fileList,(a,H)=>(r(),_("div",{key:H,class:"file-item"},[e(ie,{href:a.url,target:"_blank",type:"primary"},{default:t(()=>[d(y(a.name),1)]),_:2},1032,["href"]),l("span",Fs,y((a.size/1024/1024).toFixed(2))+"MB",1),e(C,{type:"danger",size:"small",onClick:ge=>n(k,H)},{default:t(()=>[...s[16]||(s[16]=[d("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):W("",!0)]),e(ue,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=a=>w.value=a),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",Is,[e(C,{type:"primary",onClick:Te,class:"option-btn"},{default:t(()=>[e(U,null,{default:t(()=>[e(V($e))]),_:1}),s[19]||(s[19]=d(" 本地上传 ",-1))]),_:1}),e(C,{type:"success",onClick:Pe,class:"option-btn"},{default:t(()=>[e(U,null,{default:t(()=>[e(V(Vt))]),_:1}),s[20]||(s[20]=d(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(ue,{modelValue:$.value,"onUpdate:modelValue":s[1]||(s[1]=a=>$.value=a),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(Ge,{class:"video-upload",drag:"","auto-upload":!0,action:`${V(v)}/upload`,"on-success":(a,H)=>ke(a,H,F.value),"on-error":z,multiple:"",accept:"video/*",headers:h.value},{tip:t(()=>[...s[21]||(s[21]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(U,{class:"el-icon--upload"},{default:t(()=>[e(V($e))]),_:1}),s[22]||(s[22]=l("div",{class:"el-upload__text"},[d(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","on-success","headers"])]),_:1},8,["modelValue"]),e(ue,{modelValue:i.value,"onUpdate:modelValue":s[3]||(s[3]=a=>i.value=a),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",js,[e(C,{onClick:Xe,disabled:ve.value===100},{default:t(()=>[...s[23]||(s[23]=[d(" 取消发布 ",-1)])]),_:1},8,["disabled"]),ve.value===100?(r(),le(C,{key:0,type:"primary",onClick:s[2]||(s[2]=a=>i.value=!1)},{default:t(()=>[...s[24]||(s[24]=[d(" 关闭 ",-1)])]),_:1})):W("",!0)])]),default:t(()=>[l("div",Rs,[e(Ye,{percentage:ve.value,status:ve.value===100?"success":""},null,8,["percentage","status"]),Y.value?(r(),_("div",Bs," 正在发布："+y(Y.value.label),1)):W("",!0),re.value.length>0?(r(),_("div",Os,[(r(!0),_(ee,null,te(re.value,(a,H)=>(r(),_("div",{key:H,class:ce(["result-item",a.status])},[a.status==="success"?(r(),le(U,{key:0},{default:t(()=>[e(Ze)]),_:1})):a.status==="error"?(r(),le(U,{key:1},{default:t(()=>[e(V(qe))]),_:1})):(r(),le(U,{key:2},{default:t(()=>[e(et)]),_:1})),l("span",Ns,y(a.label),1),l("span",qs,y(a.message),1)],2))),128))])):W("",!0)])]),_:1},8,["modelValue"]),e(ue,{modelValue:M.value,"onUpdate:modelValue":s[6]||(s[6]=a=>M.value=a),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Ys,[e(C,{onClick:s[5]||(s[5]=a=>M.value=!1)},{default:t(()=>[...s[25]||(s[25]=[d("取消",-1)])]),_:1}),e(C,{type:"primary",onClick:ze},{default:t(()=>[...s[26]||(s[26]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Js,[e(Be,{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=a=>N.value=a)},{default:t(()=>[l("div",Ks,[(r(!0),_(ee,null,te(q.value,a=>(r(),_("div",{key:a.id,class:"material-item"},[e(Re,{label:a.id,class:"material-checkbox"},{default:t(()=>[l("div",Ws,[l("div",Hs,y(a.filename),1),l("div",Xs,[l("span",Qs,y(a.filesize)+"MB",1),l("span",Gs,y(a.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),l("div",Zs,[s[28]||(s[28]=l("h3",null,"账号",-1)),l("div",ea,[l("div",ta,[(r(!0),_(ee,null,te(k.selectedAccounts,(a,H)=>(r(),le(Oe,{key:H,closable:"",onClose:ge=>fe(k,H),class:"account-tag"},{default:t(()=>[d(y(me(a)),1)]),_:2},1032,["onClose"]))),128))]),e(C,{type:"primary",plain:"",onClick:a=>S(k),class:"select-account-btn"},{default:t(()=>[...s[27]||(s[27]=[d(" 选择账号 ",-1)])]),_:1},8,["onClick"])])]),e(ue,{modelValue:X.value,"onUpdate:modelValue":s[9]||(s[9]=a=>X.value=a),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",na,[e(C,{onClick:s[8]||(s[8]=a=>X.value=!1)},{default:t(()=>[...s[29]||(s[29]=[d("取消",-1)])]),_:1}),e(C,{type:"primary",onClick:ne},{default:t(()=>[...s[30]||(s[30]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",la,[e(Be,{modelValue:R.value,"onUpdate:modelValue":s[7]||(s[7]=a=>R.value=a)},{default:t(()=>[l("div",sa,[(r(!0),_(ee,null,te(G.value,a=>(r(),le(Re,{key:a.id,label:a.id,class:"account-item"},{default:t(()=>[l("div",aa,[l("span",oa,y(a.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),l("div",ia,[s[31]||(s[31]=l("h3",null,"平台",-1)),e(lt,{modelValue:k.selectedPlatform,"onUpdate:modelValue":a=>k.selectedPlatform=a,class:"platform-radios"},{default:t(()=>[(r(),_(ee,null,te(D,a=>e(tt,{key:a.key,label:a.key,class:"platform-radio"},{default:t(()=>[d(y(a.name),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",ua,[s[32]||(s[32]=l("h3",null,"标题",-1)),e(xe,{modelValue:k.title,"onUpdate:modelValue":a=>k.title=a,type:"textarea",rows:3,placeholder:"请输入标题",maxlength:"100","show-word-limit":"",class:"title-input"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",da,[s[34]||(s[34]=l("h3",null,"话题",-1)),l("div",ra,[l("div",ca,[(r(!0),_(ee,null,te(k.selectedTopics,(a,H)=>(r(),le(Oe,{key:H,closable:"",onClose:ge=>oe(k,H),class:"topic-tag"},{default:t(()=>[d(" #"+y(a),1)]),_:2},1032,["onClose"]))),128))]),e(C,{type:"primary",plain:"",onClick:a=>ae(k),class:"select-topic-btn"},{default:t(()=>[...s[33]||(s[33]=[d(" 添加话题 ",-1)])]),_:1},8,["onClick"])])]),e(ue,{modelValue:J.value,"onUpdate:modelValue":s[12]||(s[12]=a=>J.value=a),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",va,[e(C,{onClick:s[11]||(s[11]=a=>J.value=!1)},{default:t(()=>[...s[38]||(s[38]=[d("取消",-1)])]),_:1}),e(C,{type:"primary",onClick:E},{default:t(()=>[...s[39]||(s[39]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",pa,[l("div",fa,[e(xe,{modelValue:b.value,"onUpdate:modelValue":s[10]||(s[10]=a=>b.value=a),placeholder:"输入自定义话题",class:"custom-input"},{prepend:t(()=>[...s[35]||(s[35]=[d("#",-1)])]),_:1},8,["modelValue"]),e(C,{type:"primary",onClick:I},{default:t(()=>[...s[36]||(s[36]=[d("添加",-1)])]),_:1})]),l("div",ma,[s[37]||(s[37]=l("h4",null,"推荐话题",-1)),l("div",_a,[(r(),_(ee,null,te(u,a=>{var H,ge;return e(C,{key:a,type:(ge=(H=L.value)==null?void 0:H.selectedTopics)!=null&&ge.includes(a)?"primary":"default",onClick:za=>Z(a),class:"topic-btn"},{default:t(()=>[d(y(a),1)]),_:2},1032,["type","onClick"])}),64))])])])]),_:1},8,["modelValue"]),k.selectedPlatform===3?(r(),_("div",ga,[s[40]||(s[40]=l("h3",null,"商品链接",-1)),e(xe,{modelValue:k.productTitle,"onUpdate:modelValue":a=>k.productTitle=a,type:"text",rows:1,placeholder:"请输入商品名称",maxlength:"200",class:"product-name-input"},null,8,["modelValue","onUpdate:modelValue"]),e(xe,{modelValue:k.productLink,"onUpdate:modelValue":a=>k.productLink=a,type:"text",rows:1,placeholder:"请输入商品链接",maxlength:"200",class:"product-link-input"},null,8,["modelValue","onUpdate:modelValue"])])):W("",!0),l("div",ya,[s[45]||(s[45]=l("h3",null,"定时发布",-1)),l("div",ha,[e(st,{modelValue:k.scheduleEnabled,"onUpdate:modelValue":a=>k.scheduleEnabled=a,"active-text":"定时发布","inactive-text":"立即发布"},null,8,["modelValue","onUpdate:modelValue"]),k.scheduleEnabled?(r(),_("div",ba,[l("div",ka,[s[41]||(s[41]=l("span",{class:"label"},"每天发布视频数：",-1)),e(Ne,{modelValue:k.videosPerDay,"onUpdate:modelValue":a=>k.videosPerDay=a,placeholder:"选择发布数量"},{default:t(()=>[(r(),_(ee,null,te(55,a=>e(Le,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",wa,[s[43]||(s[43]=l("span",{class:"label"},"每天发布时间：",-1)),(r(!0),_(ee,null,te(k.dailyTimes,(a,H)=>(r(),le(at,{key:H,modelValue:k.dailyTimes[H],"onUpdate:modelValue":ge=>k.dailyTimes[H]=ge,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),k.dailyTimes.length<k.videosPerDay?(r(),le(C,{key:0,type:"primary",size:"small",onClick:a=>k.dailyTimes.push("10:00")},{default:t(()=>[...s[42]||(s[42]=[d(" 添加时间 ",-1)])]),_:1},8,["onClick"])):W("",!0)]),l("div",$a,[s[44]||(s[44]=l("span",{class:"label"},"开始天数：",-1)),e(Ne,{modelValue:k.startDays,"onUpdate:modelValue":a=>k.startDays=a,placeholder:"选择开始天数"},{default:t(()=>[e(Le,{label:"明天",value:0}),e(Le,{label:"后天",value:1})]),_:1},8,["modelValue","onUpdate:modelValue"])])])):W("",!0)])]),l("div",Ca,[e(C,{size:"small",onClick:a=>Se()},{default:t(()=>[...s[46]||(s[46]=[d("取消",-1)])]),_:1},8,["onClick"]),e(C,{size:"small",type:"primary",onClick:a=>_e(k)},{default:t(()=>[...s[47]||(s[47]=[d("发布",-1)])]),_:1},8,["onClick"])])])),[[Fe,x.value===k.name]])),128))])])])}}},Aa=Ce(Va,[["__scopeId","data-v-36db4443"]]),Ta={class:"about"},xa={__name:"About",setup(p){return(v,h)=>(r(),_("div",Ta,[...h[0]||(h[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ma=Ce(xa,[["__scopeId","data-v-cd67ee8e"]]),Sa=[{path:"/",name:"Dashboard",component:yl},{path:"/account-management",name:"AccountManagement",component:os},{path:"/material-management",name:"MaterialManagement",component:$s},{path:"/publish-center",name:"PublishCenter",component:Aa},{path:"/about",name:"About",component:Ma}],Ua=dt({history:rt(),routes:Sa}),Pa=ct(),Ae=pt(Ft);for(const[p,v]of Object.entries(At))Ae.component(p,v);Ae.use(Ua);Ae.use(Pa);Ae.use(Tt);Ae.mount("#app");
